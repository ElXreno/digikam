From 31e5507db917d7d914f1e3f3c24f5d6777d61f88 Mon Sep 17 00:00:00 2001
From: Maik Qualmann <metzpinguin@gmail.com>
Date: Mon, 14 Nov 2016 20:42:18 +0100
Subject: [PATCH 34/34] try to fix crash under wayland, native support later
 CCBUGS: 370392

---
 libs/dimg/filters/icc/iccsettings.cpp | 6 ++++++
 1 file changed, 6 insertions(+)

diff --git a/libs/dimg/filters/icc/iccsettings.cpp b/libs/dimg/filters/icc/iccsettings.cpp
index 0195df7..c0d3de2 100644
--- a/libs/dimg/filters/icc/iccsettings.cpp
+++ b/libs/dimg/filters/icc/iccsettings.cpp
@@ -191,6 +191,12 @@ IccProfile IccSettings::Private::profileFromWindowSystem(QWidget* const widget)
 {
 #ifdef HAVE_X11
 
+    if (!QX11Info::isPlatformX11())
+    {
+        qCDebug(DIGIKAM_DIMG_LOG) << "Desktop platform is not X11";
+        return IccProfile();
+    }
+
     unsigned long appRootWindow;
     QString       atomName;
 
-- 
2.7.4

